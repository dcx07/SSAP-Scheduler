<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="SSAP_MAUI.Views.SchedulePage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:SSAP_MAUI.Models"
             Title="今日课程"
             BackgroundColor="{StaticResource Tertiary}">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header -->
        <StackLayout Grid.Row="0" 
                     BackgroundColor="White"
                     Padding="16"
                     Orientation="Horizontal">
            
            <Label Text="📅"
                   FontSize="24"
                   VerticalOptions="Center" />
                   
            <StackLayout Spacing="2"
                         VerticalOptions="Center"
                         Margin="10,0,0,0">
                <Label Text="{Binding Username}"
                       FontFamily="NotoSansSC"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray900}" />
                <Label Text="{Binding TodayDate}"
                       FontFamily="NotoSansSC"
                       FontSize="12"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray600}" />
            </StackLayout>
            
            <!-- Refresh Button -->
            <Button Text="🔄"
                    Command="{Binding RefreshScheduleCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource Primary}"
                    FontSize="18"
                    BorderWidth="0"
                    HorizontalOptions="EndAndExpand"
                    VerticalOptions="Center"
                    Padding="8" />
                    
        </StackLayout>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            
            <!-- Loading Indicator -->
            <StackLayout IsVisible="{Binding IsLoading}"
                         VerticalOptions="Center"
                         HorizontalOptions="Center">
                <ActivityIndicator IsRunning="{Binding IsLoading}"
                                   Color="{StaticResource Primary}"
                                   HeightRequest="40" />
                <Label Text="正在加载课程..."
                       FontFamily="NotoSansSC"
                       TextColor="{StaticResource Gray600}"
                       HorizontalTextAlignment="Center"
                       Margin="0,10,0,0" />
            </StackLayout>

            <!-- Error Message -->
            <Label Text="{Binding ErrorMessage}"
                   IsVisible="{Binding ErrorMessage.Length}"
                   FontFamily="NotoSansSC"
                   TextColor="Red"
                   HorizontalTextAlignment="Center"
                   VerticalOptions="Center"
                   Margin="16" />

            <!-- Course List -->
            <CollectionView ItemsSource="{Binding Courses}"
                            IsVisible="{Binding Courses.Count}"
                            Margin="16,8">
                
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Course">
                        <Grid Padding="0,8">
                            <Frame BackgroundColor="White"
                                   CornerRadius="12"
                                   HasShadow="True"
                                   Padding="16">
                                
                                <Grid ColumnDefinitions="Auto,*">
                                    
                                    <!-- Emoji -->
                                    <Label Grid.Column="0"
                                           Text="{Binding DisplayEmoji}"
                                           FontSize="24"
                                           VerticalOptions="Start"
                                           Margin="0,0,16,0" />
                                    
                                    <!-- Course Details -->
                                    <StackLayout Grid.Column="1" 
                                                 Spacing="4">
                                        
                                        <!-- Course Name -->
                                        <Label Text="{Binding Name}"
                                               FontFamily="NotoSansSC"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Gray900}"
                                               LineBreakMode="WordWrap" />
                                        
                                        <!-- Time -->
                                        <StackLayout Orientation="Horizontal">
                                            <Label Text="⏰"
                                                   FontSize="14"
                                                   VerticalOptions="Center" />
                                            <Label Text="{Binding TimeRange}"
                                                   FontFamily="NotoSansSC"
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"
                                                   VerticalOptions="Center"
                                                   Margin="4,0,0,0" />
                                        </StackLayout>
                                        
                                        <!-- Location -->
                                        <StackLayout Orientation="Horizontal">
                                            <Label Text="📍"
                                                   FontSize="14"
                                                   VerticalOptions="Center" />
                                            <Label Text="{Binding Room}"
                                                   FontFamily="NotoSansSC"
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"
                                                   VerticalOptions="Center"
                                                   Margin="4,0,0,0"
                                                   LineBreakMode="WordWrap" />
                                        </StackLayout>
                                        
                                        <!-- Teacher -->
                                        <StackLayout Orientation="Horizontal">
                                            <Label Text="👨‍🏫"
                                                   FontSize="14"
                                                   VerticalOptions="Center" />
                                            <Label Text="{Binding Teacher}"
                                                   FontFamily="NotoSansSC"
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"
                                                   VerticalOptions="Center"
                                                   Margin="4,0,0,0"
                                                   LineBreakMode="WordWrap" />
                                        </StackLayout>
                                        
                                    </StackLayout>
                                    
                                </Grid>
                                
                            </Frame>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                
            </CollectionView>

        </Grid>

    </Grid>

</ContentPage>
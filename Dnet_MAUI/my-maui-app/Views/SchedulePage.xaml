<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:System="clr-namespace:System;assembly=System.Runtime"
             x:Class="MyMauiApp.Views.SchedulePage"
             BackgroundColor="{StaticResource LoginBackground}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackLayout Grid.Row="0" Padding="24,20,24,16" BackgroundColor="White">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0" Text="📅" FontSize="24" VerticalOptions="Center" />
                
                <StackLayout Grid.Column="1" Margin="10,0,0,0" VerticalOptions="Center">
                    <Label Text="{Binding Username}"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}" />
                    <Label Text="{Binding Source={x:Static System:DateTime.Now}, StringFormat='{0:yyyy年M月d日 dddd}'}"
                           FontSize="12"
                           TextColor="{StaticResource Gray600}" />
                </StackLayout>

                <Button Grid.Column="2" 
                        Text="🔄" 
                        Command="{Binding FetchScheduleCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        CornerRadius="20"
                        WidthRequest="40"
                        HeightRequest="40"
                        FontSize="16" />
            </Grid>
        </StackLayout>

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <StackLayout Padding="24">
                <CollectionView ItemsSource="{Binding Courses}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="White"
                                   CornerRadius="12"
                                   Margin="0,0,0,16"
                                   HasShadow="True"
                                   Padding="16">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Label Grid.Column="0"
                                           Text="{Binding Emoji}"
                                           FontSize="32"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           Margin="0,0,16,0" />

                                    <StackLayout Grid.Column="1" VerticalOptions="Center">
                                        <Label Text="{Binding Name}"
                                               FontAttributes="Bold"
                                               FontSize="18"
                                               TextColor="{StaticResource Primary}"
                                               LineBreakMode="WordWrap" />
                                        
                                        <Label FontSize="14" TextColor="{StaticResource Gray600}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="🕐 " />
                                                    <Span Text="{Binding Start}" />
                                                    <Span Text=" - " />
                                                    <Span Text="{Binding End}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <Label FontSize="14" TextColor="{StaticResource Gray600}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="📍 " />
                                                    <Span Text="{Binding Room}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>

                                        <Label FontSize="14" TextColor="{StaticResource Gray600}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="👨‍🏫 " />
                                                    <Span Text="{Binding Teacher}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </StackLayout>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.EmptyView>
                        <ContentView>
                            <StackLayout HorizontalOptions="Center" VerticalOptions="Center" Padding="20">
                                <Label Text="📚" FontSize="64" HorizontalOptions="Center" />
                                <Label Text="今天没有课程" 
                                       FontSize="16" 
                                       TextColor="{StaticResource Gray500}"
                                       HorizontalOptions="Center" />
                            </StackLayout>
                        </ContentView>
                    </CollectionView.EmptyView>
                </CollectionView>

                <!-- Loading indicator -->
                <StackLayout IsVisible="{Binding IsLoading}" 
                            HorizontalOptions="Center" 
                            VerticalOptions="Center"
                            Padding="40">
                    <ActivityIndicator IsRunning="{Binding IsLoading}" 
                                      Color="{StaticResource Primary}"
                                      WidthRequest="40"
                                      HeightRequest="40" />
                    <Label Text="加载中..." 
                           FontSize="16" 
                           TextColor="{StaticResource Gray500}"
                           HorizontalOptions="Center"
                           Margin="0,16,0,0" />
                </StackLayout>
            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>